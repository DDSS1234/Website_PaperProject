<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Creating with Paper â€“ Instructions</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <button id="menuBtn" aria-label="Open menu" aria-expanded="false" aria-controls="siteMenu" class="menu-btn">
      <svg viewBox="0 0 24 24" width="28" height="28" class="burger">
        <path class="l1" d="M3 10h16" />
        <path class="l2" d="M3 14h16" />
      </svg>
    </button>
  </header>

  <nav id="siteMenu" class="menu" hidden>
    <ul>
      <li><a href="Test.html">Home</a></li>
      <li><a href="About.html">About</a></li>
      <li><a href="instructions.html">Instructions</a></li>
    </ul>
  </nav>

  <div class="progress"><div class="progress-bar"></div></div>

  <main class="instructions-main">
    <div class="instructions-container">
      <div class="step">
        <h1 class="step-title">Module</h1>
        <img class="instruction-image" src="images/Place.png" alt="Step 1 icon" data-detail="Detailed information for the placeholder step.">
        <h4 class="step-description">Start</h4>
      </div>
      <div class="step">
        <h2 class="step-title">Step 1</h2>
        <img class="instruction-image" src="images/Place.png" alt="Step 1 icon" data-detail="Materials needed">
        <h4 class="step-description">Gather</h4>
      </div>
      <div class="step">
        <h2 class="step-title">Step 2</h2>
        <img class="instruction-image" src="images/Place.png" alt="Step 2 icon" data-detail="Shred paper or tear paper into small pieces about 1 in. in size. This will help the blender process the paper into pulp.">
        <h4 class="step-description">Prepare</h4>
      </div>
      <div class="step">
        <h2 class="step-title">Step 3</h2>
        <img class="instruction-image" src="images/Place.png" alt="Step 3 icon" data-detail="Blend the paper into a consistency that is similiar to a chowder. It will be a bit clumpy but we'll break it up during the next process.">
        <h4 class="step-description">Blend</h4>
      </div>
      <div class="step">
        <h2 class="step-title">Step 4</h2>
        <img class="instruction-image" src="images/Place.png" alt="Step 4 icon" data-detail="Take your mould and submerge it in water. From there, pour the pulp into the mould, being careful to pour it into the mould and not outside of it. Afterwards, run your fingers through the mould, being careful not to touch the bottom as this can cause clumps during the forming process.">
        <h4 class="step-description">Pour</h4>
      </div>
      <div class="step">
        <h2 class="step-title">Step 5</h2>
        <img class="instruction-image" src="images/Place.png" alt="Step 5 icon" data-detail="Pull the mould out of the water. Move it back and forth as water drains through the bottom to evenly disperse the cellulose particles.">
        <h4 class="step-description">Pull</h4>
      </div>
      <div class="step">
        <h2 class="step-title">Step 6</h2>
        <img class="instruction-image" src="images/Place.png" alt="Step 6 icon" data-detail="While the pulp is still in the mould, press it with a sponge separated from the paper with a fine mesh, or with something that won't absorb water.">
        <h4 class="step-description">Press</h4>
      </div>
      <div class="step">
        <h2 class="step-title">Step 7</h2>
        <img class="instruction-image" src="images/Place.png" alt="Step 7 icon" data-detail="Remove the sides from the mould and place on a blotter sheet.">
        <h4 class="step-description">Remove</h4>
      </div>
      <div class="step">
        <h2 class="step-title">Step 8</h2>
        <img class="instruction-image" src="images/Place.png" alt="Step 8 icon" data-detail="Sandwhich the paper layer between two absorbent layers to remove water. Make sure it's well ventilated while drying and try and place it in the sun if you can. Dry under pressure to avoid twisting of the paper as it dries. Drying time is approximately 1 in. per week.">
        <h4 class="step-description">Dry</h4>
      </div>
      <div class="step">
        <h2 class="step-title">Step 9</h2>
        <img class="instruction-image" src="images/Place.png" alt="Step 9 icon" data-detail="Make more and stack them together for furniture or wall coverings.">
        <h4 class="step-description">Build</h4>
      </div>
      <div class="step">
        <h4 class="step-description">Questions?</h4>
      </div>      
    </div>
  </main>
<script src="instruction-interactions.js"></script>  
<script>
  const btn = document.getElementById('menuBtn');
  const menu = document.getElementById('siteMenu');

  function setOpen(isOpen) {
    btn.setAttribute('aria-expanded', String(isOpen));
    if (isOpen) {
      menu.hidden = false;
      menu.dataset.open = 'true';
      document.documentElement.classList.add('menu-open');
      document.body.classList.add('menu-open');
    } else {
      menu.dataset.open = 'false';
      document.documentElement.classList.remove('menu-open');
      document.body.classList.remove('menu-open');
      setTimeout(() => { menu.hidden = true; }, 400);
    }
  }

  btn.addEventListener('click', () => {
    const open = btn.getAttribute('aria-expanded') === 'true';
    setOpen(!open);
  });

  window.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && btn.getAttribute('aria-expanded') === 'true') setOpen(false);
  });

  menu.addEventListener('click', (e) => {
    if (e.target === menu) setOpen(false);
  });
  
  const container = document.querySelector('.instructions-container');
  const progressBar = document.querySelector('.progress-bar');
  let isWheelScrolling = false;
  let stepHeight = container.clientHeight;
  let lastTop = 0;  

  function updateStepHeight() {
    stepHeight = container.clientHeight;
  }

  function toggleEndPanel(){
    const max = container.scrollHeight - container.clientHeight;
    const dir = Math.sign(container.scrollTop - lastTop);  // +1 down, -1 up
    lastTop = container.scrollTop;

    const nearBottom = container.scrollTop >= max - stepHeight * 0.6; // threshold ~60% of one panel
    if (dir > 0 && nearBottom) {
      document.body.classList.add('show-end');    // slide up
    } else if (dir < 0) {
      document.body.classList.remove('show-end'); // slide back down
    }
  }

  container.addEventListener('wheel', (e) => {
    e.preventDefault();
    if (isWheelScrolling) return;
    isWheelScrolling = true;

    const dir = Math.sign(e.deltaY) || 1;
    const max = container.scrollHeight - container.clientHeight;
    const nextTop = Math.max(0, Math.min(container.scrollTop + dir * stepHeight, max));

    container.scrollTo({ top: nextTop, behavior: 'smooth' });

    // allow another tick after the smooth scroll settles
    setTimeout(() => { isWheelScrolling = false; }, 500);
  }, { passive: false });

  function updateProgress() {
    const max = container.scrollHeight - container.clientHeight;
    const percent = max ? container.scrollTop / max : 0;
    // On screens wider than 768px, the progress bar fills vertically (height changes, width is 100%)
    if (window.matchMedia('(min-width: 768px)').matches) {
      progressBar.style.height = `${percent * 100}%`;
      progressBar.style.width = '100%';
    } else {
      // On smaller screens, the progress bar fills horizontally (width changes, height is 100%)
      progressBar.style.width = `${percent * 100}%`;
      progressBar.style.height = '100%';
    }
  }

  container.addEventListener('scroll', updateProgress);
  container.addEventListener('scroll', toggleEndPanel, { passive: true });
  window.addEventListener('resize', () => {
    updateStepHeight();
    updateProgress();
    stepHeight = container.clientHeight;
  });
  updateStepHeight();
  updateProgress();
</script>

<div id="endPanel" aria-hidden="true">
  <div class="inner">
    <h2>Questions?</h2>
    <p>your.email@example.com<br>IG: @yourhandle</p>
  </div>
</div>
</body>
</html>