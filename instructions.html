<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Creating with Paper – Instructions</title>
  <link rel="stylesheet" href="style.css">
  <script>
    const savedLang = localStorage.getItem('lang');
    if (savedLang) {
      document.documentElement.lang = savedLang;
      document.documentElement.dir = savedLang === 'ar' ? 'rtl' : 'ltr';
    }
  </script>  
</head>
<body>
  <header>
    <button id="menuBtn" aria-label="Open menu" aria-expanded="false" aria-controls="siteMenu" class="menu-btn">
      <svg viewBox="0 0 24 24" width="28" height="28" class="burger">
        <path class="l1" d="M3 10h16" />
        <path class="l2" d="M3 14h16" />
      </svg>
    </button>
  </header>

  <nav id="siteMenu" class="menu" hidden>
    <ul>
      <li><a href="Test.html">Home</a></li>
      <li><a href="About.html">About</a></li>
      <li><a href="instructions.html">Instructions</a></li>
    </ul>
  </nav>

  <div class="progress"><div class="progress-bar"></div></div>

  <main class="instructions-main">
    <div class="instructions-container">
      <div class="step">
        <h1 class="step-title">M</h1>
        <img class="instruction-image" src="images/Place.png" alt="Step 1 icon">
        <h4 class="step-description">Start</h4>
      </div>
      <div class="step">
        <h1 class="step-title">1</h1>
        <img class="instruction-image" src="images/Place.png" alt="Step 1 icon" data-detail="Collect all necessary materials: paper scraps, blender, mould & deckle, sponge, fine mesh, blotter sheets, absorbent layers (e.g., towels or felt), water container, some sunlight or a drying rack. Extra buckets, a shredder, and a wet vacuum can help speed up the process.">
        <h4 class="step-description">Gather</h4>
      </div>
      <div class="step">
        <h1 class="step-title">2</h1>
        <img class="instruction-image" src="images/Place.png" alt="Step 2 icon" data-detail="Tear or shred paper into pieces about 1 in (2-3 cm) across. Smaller pieces blend faster and more evenly.">
        <h4 class="step-description">Prepare</h4>
      </div>
      <div class="step">
        <h1 class="step-title">3</h1>
        <img class="instruction-image" src="images/Place.png" alt="Step 3 icon" data-detail="Place paper pieces into a blender with water (about 1 part paper to 4 parts water). Blend until the mixture looks like thick oatmeal — slightly clumpy is fine.">
        <h4 class="step-description">Blend</h4>
      </div>
      <div class="step">
        <h1 class="step-title">4</h1>
        <img class="instruction-image" src="images/Place.png" alt="Step 4 icon" data-detail="Submerge the mould and deckle in water. Pour pulp into the mould evenly, avoiding overflow. Use fingers to gently stir the pulp, keeping them above the mesh to prevent clumps.">
        <h4 class="step-description">Pour</h4>
      </div>
      <div class="step">
        <h1 class="step-title">5</h1>
        <img class="instruction-image" src="images/Place.png" alt="Step 5 icon" data-detail="Lift the mould straight up out of the water. Tilt and gently shake it side-to-side to help water drain and distribute fibers evenly.">
        <h4 class="step-description">Pull</h4>
      </div>
      <div class="step">
        <h1 class="step-title">6</h1>
        <img class="instruction-image" src="images/Place.png" alt="Step 6 icon" data-detail="With the pulp still in the mould, place fine mesh or cloth over it. Press with a sponge or flat object to remove as much water as possible. This is a little different from paper sheet making because we want to retain our shape size.">
        <h4 class="step-description">Press</h4>
      </div>
      <div class="step">
        <h1 class="step-title">7</h1>
        <img class="instruction-image" src="images/Place.png" alt="Step 7 icon" data-detail="Remove the frame sides carefully so the sheet stays intact. Transfer it onto a blotter sheet for support.">
        <h4 class="step-description">Remove</h4>
      </div>
      <div class="step">
        <h1 class="step-title">8</h1>
        <img class="instruction-image" src="images/Place.png" alt="Step 8 icon" data-detail="Place the sheet between absorbent layers. Keep well-ventilated and in sunlight if possible. Apply light pressure to prevent warping. Drying time is about 1 inch (2-3cm) of thickness per week.">
        <h4 class="step-description">Dry</h4>
      </div>
      <div class="step">
        <h1 class="step-title">9</h1>
        <img class="instruction-image" src="images/Place.png" alt="Step 9 icon" data-detail="Repeat to create multiple sheets or modules. Stack or join them for furniture, wall panels, or other projects.">
        <h4 class="step-description">Build</h4>
      </div>
      <div class="step">
        <h4 class="step-description">Questions?</h4>
      </div>      
    </div>
  </main>
<script src="instruction-interactions.js"></script>  
<script>
  const btn = document.getElementById('menuBtn');
  const menu = document.getElementById('siteMenu');

  function setOpen(isOpen) {
    btn.setAttribute('aria-expanded', String(isOpen));
    if (isOpen) {
      menu.hidden = false;
      menu.dataset.open = 'true';
      document.documentElement.classList.add('menu-open');
      document.body.classList.add('menu-open');
    } else {
      menu.dataset.open = 'false';
      document.documentElement.classList.remove('menu-open');
      document.body.classList.remove('menu-open');
      setTimeout(() => { menu.hidden = true; }, 400);
    }
  }

  btn.addEventListener('click', () => {
    const open = btn.getAttribute('aria-expanded') === 'true';
    setOpen(!open);
  });

  window.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && btn.getAttribute('aria-expanded') === 'true') setOpen(false);
  });

  menu.addEventListener('click', (e) => {
    if (e.target === menu) setOpen(false);
  });
  
  const container = document.querySelector('.instructions-container');
  const progressBar = document.querySelector('.progress-bar');
  let isWheelScrolling = false;
  let stepHeight = container.clientHeight;
  let lastTop = 0;  

  function updateStepHeight() {
    stepHeight = container.clientHeight;
  }

  function toggleEndPanel(){
    const max = container.scrollHeight - container.clientHeight;
    const dir = Math.sign(container.scrollTop - lastTop);  // +1 down, -1 up
    lastTop = container.scrollTop;

    const nearBottom = container.scrollTop >= max - stepHeight * 0.6; // threshold ~60% of one panel
    if (dir > 0 && nearBottom) {
      document.body.classList.add('show-end');    // slide up
    } else if (dir < 0) {
      document.body.classList.remove('show-end'); // slide back down
    }
  }

  container.addEventListener('wheel', (e) => {
    e.preventDefault();
    if (isWheelScrolling) return;
    isWheelScrolling = true;

    const dir = Math.sign(e.deltaY) || 1;
    const max = container.scrollHeight - container.clientHeight;
    const nextTop = Math.max(0, Math.min(container.scrollTop + dir * stepHeight, max));

    container.scrollTo({ top: nextTop, behavior: 'smooth' });

    // allow another tick after the smooth scroll settles
    setTimeout(() => { isWheelScrolling = false; }, 500);
  }, { passive: false });

  function updateProgress() {
    const max = container.scrollHeight - container.clientHeight;
    const percent = max ? container.scrollTop / max : 0;
    // On screens wider than 768px, the progress bar fills vertically (height changes, width is 100%)
    if (window.matchMedia('(min-width: 768px)').matches) {
      progressBar.style.height = `${percent * 100}%`;
      progressBar.style.width = '100%';
    } else {
      // On smaller screens, the progress bar fills horizontally (width changes, height is 100%)
      progressBar.style.width = `${percent * 100}%`;
      progressBar.style.height = '100%';
    }
  }

  container.addEventListener('scroll', updateProgress);
  container.addEventListener('scroll', toggleEndPanel, { passive: true });
  window.addEventListener('resize', () => {
    updateStepHeight();
    updateProgress();
    stepHeight = container.clientHeight;
  });
  updateStepHeight();
  updateProgress();
</script>

<div id="endPanel" aria-hidden="true">
  <div class="inner">
    <h2>Questions?</h2>
    <p>alexrosno@gmail.com<br><li><a href="https://www.instagram.com/ajrosno/?hl=en">Instagram</a></li></p>
  </div>
</div>
</body>
</html>